---
import Layout from '../../layout/Layout.astro';

const project = {
  title: "HurricAIne",
  tagline: "Predicting where hurricanes go next—using deep learning and 40 years of atmospheric data.",
  date: "2024",
  role: "ML Engineer & Data Pipeline Architect",
  repoUrl: "https://github.com/crowmoed/HurricAIne---Python",
  stack: ["Python", "TensorFlow/Keras", "xarray", "ERA5 API", "Plotly", "XGBoost"]
};

const githubIcon = `
<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.05-.015-2.07-3.345.72-4.05-1.605-4.05-1.605-.54-1.38-1.335-1.755-1.335-1.755-1.095-.75.09-.735.09-.735 1.215.09 1.845 1.245 1.845 1.245 1.08 1.845 2.835 1.305 3.525.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.225 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405 1.02 0 2.04.135 3 .405 2.295-1.545 3.3-1.23 3.3-1.23.66 1.695.24 2.925.12 3.225.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.285 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
</svg>`;
---

<Layout>
  <div class="projects-wrapper back">
    
    <div class="detail-container">
      
      <header class="detail-header fade-in">
        <a href="/projects" class="back-link">
          <span class="arrow">←</span> All Projects
        </a>
        <h1>{project.title}</h1>
        <p class="tagline">{project.tagline}</p>
      </header>

      <div class="content-grid fade-in-delay">
        
        <main class="project-body">
          <div class="project-hero-image">
             <img src="/hurricAIne-poster.png" style="width: 100%; height: 100%; display: block;"/>
          </div>

          <div class="text-content">
            <h3>Why This Project?</h3>
            <p>
              Hurricanes are chaotic. The atmosphere doesn't play nice with predictions, observational data over oceans is sparse, and forecasters need answers <em>fast</em>. Traditional numerical weather models demand supercomputer-level resources and still miss short-term movements.
            </p>
            <p>
              I wanted to see if a lightweight CNN could do better—specifically, predict where a storm will be <strong>6 hours from now</strong> using freely available reanalysis data.
            </p>

            <h3>The Data Problem</h3>
            <p>
              Two data sources power this system:
            </p>
            <ul>
              <li><strong>ERA5 Reanalysis</strong> — Gridded atmospheric fields from ECMWF, downloaded as monthly NetCDF files via the CDS API. I built an LRU-style cache to avoid hammering the disk.</li>
              <li><strong>HURDAT2 Best Tracks</strong> — Ground-truth storm positions at 6-hour intervals, stored as JSON indexed by timestamp.</li>
            </ul>
            <p>
              The tricky part? ERA5 uses 0–360° longitude. HURDAT uses -180/180°. Storms cross the date line. I spent more time than I'd like to admit wrestling with <code>xr.roll()</code> and coordinate reassignment to make these play together.
            </p>

            <h3>What Goes Into the Model</h3>
            <p>
              For each timestep, I extract a <strong>70° × 70° box</strong> centered on the storm, then resize it to a clean <strong>40 × 40 × 17</strong> tensor:
            </p>
            <ul>
              <li><strong>5 surface channels:</strong> 10m winds (u, v), sea level pressure, SST, water vapor</li>
              <li><strong>12 pressure-level channels:</strong> Wind components + relative humidity at 200, 500, 700, and 850 hPa</li>
            </ul>
            <p>
              The target is dead simple: <code>next_position - current_position</code>. Just the displacement in degrees.
            </p>

            <h3>The CNN Architecture</h3>
            <p>
              I optimized for parameter efficiency without sacrificing spatial awareness:
            </p>
            <ul>
              <li><strong>Separable Convolutions</strong> — Fewer parameters, same spatial feature extraction</li>
              <li><strong>Residual Block</strong> — 1×1 shortcut + dual separable convs. Helps when atmospheric patterns are persistent (the model can learn "just pass it through")</li>
              <li><strong>Channel Attention</strong> — The model learns which variables matter most. Sometimes SST dominates; sometimes it's wind shear</li>
              <li><strong>Spatial Attention</strong> — Hurricanes aren't symmetric. This lets the model focus on the relevant quadrant</li>
            </ul>
            <p>
              The head is straightforward: GlobalAveragePooling → Dense(128) → Dense(64) → Dense(2) outputting <code>[Δlat, Δlon]</code>.
            </p>

            <h3>Running Inference</h3>
            <p>
              At prediction time:
            </p>
            <ol>
              <li>Load saved normalization stats</li>
              <li>Build the feature tensor for the current timestep</li>
              <li>Forward pass → denormalize the output</li>
              <li>Add the predicted delta to current position</li>
            </ol>
            <p>
              Error is measured via Haversine approximation (roughly Δ° × 111 km). Visualization uses Plotly Scattermaps—actual tracks overlaid with predictions, bubble size scaled to storm radius, color-coded by intensity.
            </p>

            <h3>The Baseline: SHIPS + XGBoost</h3>
            <p>
              Not everything needs a CNN. I also built a tabular baseline using SHIPS diagnostic files—10 scalar features (lat, lon, vmax, pressure, SST, ocean heat content, shear, humidity, distance to land, MPI) fed into XGBoost for 24-hour predictions.
            </p>
            <p>
              It's faster, needs no GPU, and provides a sanity check. The CNN wins on accuracy, but the gap isn't as large as you might expect.
            </p>

            <h3>Edge Cases I Had to Handle</h3>
            <ul>
              <li><strong>Zero-dimension tensors</strong> — TensorFlow crashes hard if you don't validate shapes before resize</li>
              <li><strong>Storm ID mismatches</strong> — Had to filter to ensure consecutive timesteps belong to the same system</li>
              <li><strong>Memory leaks</strong> — ERA5 cache gets cleared after each storm to prevent file handle exhaustion</li>
              <li><strong>Coordinate hell</strong> — Longitude sign conventions differ between every data source. Fixed in slicing <em>and</em> rendering</li>
            </ul>
          </div>
        </main>

        <aside class="project-sidebar">
          
          <div class="meta-block">
            <span class="meta-label">Role</span>
            <span class="meta-value">{project.role}</span>
          </div>

          <div class="meta-block">
            <span class="meta-label">Timeline</span>
            <span class="meta-value">{project.date}</span>
          </div>

          <div class="meta-block">
            <span class="meta-label">Stack</span>
            <div class="tech-stack-wrap">
              {project.stack.map(tech => (
                <span class="tech-tag">{tech}</span>
              ))}
            </div>
          </div>

          <div class="meta-block">
            <span class="meta-label">Data Sources</span>
            <div class="tech-stack-wrap">
              <span class="tech-tag">ERA5</span>
              <span class="tech-tag">HURDAT2</span>
              <span class="tech-tag">NOAA OISST</span>
              <span class="tech-tag">SHIPS</span>
            </div>
          </div>

          <div class="meta-block">
            <span class="meta-label">Output</span>
            <span class="meta-value">6-hour displacement (Δlat, Δlon)</span>
          </div>

          <div class="meta-block">
            <span class="meta-label">Input Shape</span>
            <span class="meta-value">(40, 40, 17)</span>
          </div>

          <div class="action-buttons">
            <a href={project.repoUrl} target="_blank" class="action-btn outline">
              <span class="icon" set:html={githubIcon} />
              View Code
            </a>
          </div>

        </aside>

      </div>

    </div>
  </div>
</Layout>