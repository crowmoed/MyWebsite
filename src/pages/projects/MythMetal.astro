---
import Layout from '../../layout/Layout.astro';

const project = {
  title: "Myth & Metal",
  tagline: "Minecraft Forge mod featuring procedural dungeons, tiered item rarity, and custom rendering systems.",
  date: "2024",
  role: "Mod Developer & Systems Architect",
  repoUrl: "https://github.com/crowmoed/Myth-Metal---Java",
  stack: ["Java", "Minecraft Forge", "Mixins", "Terrablender", "OpenGL/RenderTypes"]
};

const githubIcon = `
<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.05-.015-2.07-3.345.72-4.05-1.605-4.05-1.605-.54-1.38-1.335-1.755-1.335-1.755-1.095-.75.09-.735.09-.735 1.215.09 1.845 1.245 1.845 1.245 1.08 1.845 2.835 1.305 3.525.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.225 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405 1.02 0 2.04.135 3 .405 2.295-1.545 3.3-1.23 3.3-1.23.66 1.695.24 2.925.12 3.225.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.285 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
</svg>`;
---

<Layout>
  <div class="projects-wrapper back">
    
    <div class="detail-container">
      
      <header class="detail-header fade-in">
        <a href="/projects" class="back-link">
          <span class="arrow">←</span> All Projects
        </a>
        <h1>{project.title}</h1>
        <p class="tagline">{project.tagline}</p>
      </header>

      <div class="content-grid fade-in-delay">
        
        <main class="project-body">
          <div class="project-hero-image">
             <div class="placeholder-overlay">Dungeon Boss Fight with Tier VII Weapon Glint</div>
          </div>

          <div class="text-content">
            <h3>Overview</h3>
            <p>
              Myth & Metal is a comprehensive Minecraft Forge mod that overhauls progression through a tiered item rarity system, procedurally generated dungeons with wave-based combat, custom boss encounters, and entirely new biomes. The mod required deep integration with Minecraft's rendering pipeline via Mixins and custom world generation through Terrablender.
            </p>

            <h3>Item Rarity & Tier System</h3>
            <p>
              The core progression system introduces seven rarity tiers (I–VII) with escalating damage multipliers from 1.0× to 5.0×. Unlike vanilla enchantments, rarity is stored <strong>per-item-instance</strong> via NBT tags, allowing identical weapon types to exist at different power levels.
            </p>
            <p>
              Implementation uses a Mixin into <code>ItemStack</code> with two injection points: <code>@Inject</code> on <code>getTooltipLines</code> appends rarity display, while <code>@Redirect</code> on <code>EnchantmentHelper.getDamageBonus</code> intercepts damage calculation to apply tier multipliers before enchantment bonuses. A custom anvil block (<code>CustomAnvilTierMenu</code>) extends <code>ItemCombinerMenu</code> to handle tier upgrades—placing an <code>UpgradeIngot</code> of higher tier transfers that tier to the target item.
            </p>

            <h3>Custom Rendering System</h3>
            <p>
              Each tier has a unique enchantment glint effect, requiring ~42 custom <code>RenderType</code> instances (7 tiers × 6 variants: basic glint, direct, entity-held, entity-direct, armor). These are constructed via <code>RenderType.CompositeState.builder()</code> with custom texture states pointing to tier-specific glint textures.
            </p>
            <p>
              Mixins into <code>ItemRenderer</code> and <code>HumanoidArmorLayer</code> intercept vanilla glint buffer requests, substituting tier-appropriate render types based on the item's rarity NBT. The armor mixin completely replaces <code>render()</code> via <code>@Inject(at = HEAD, cancellable = true)</code>, iterating equipment slots and calling custom <code>renderArmorPieceOutline()</code> methods that apply tier-specific glint after base armor and trim rendering.
            </p>

            <h3>Procedural Dungeon System</h3>
            <p>
              Dungeons are self-contained challenge arenas generated on first portal entry. The architecture uses <strong>invisible trigger blocks</strong> with attached <code>BlockEntity</code> instances to manage room state:
            </p>
            <ul>
              <li><strong>Room Detection:</strong> When a player enters a trigger block, a recursive 6-directional flood-fill calculates room boundaries by propagating through adjacent <code>DungeonAirEntity</code> blocks</li>
              <li><strong>Containment:</strong> Iron bars (indestructible, <code>strength = -1.0F</code>) spawn on room edges, trapping the player</li>
              <li><strong>Wave Spawning:</strong> <code>DungeonRoomEntity</code> maintains mob count (16 total) and alive count (capped at 6 concurrent). Mobs spawn at validated positions (air blocks, no collision) with back-references to the room for death callbacks</li>
              <li><strong>Completion:</strong> When all mobs die, <code>setDefeatedRoom()</code> recursively propagates through trigger blocks, replacing them with air and removing barriers</li>
            </ul>
            <p>
              Dungeon mobs (<code>DungeonSkeleton</code>, <code>DungeonSpider</code>, etc.) extend vanilla counterparts with fire immunity, bonus fire damage on attacks, and <code>die()</code> overrides that call <code>ThisdungeonRoom.mobDied()</code>.
            </p>

            <h3>Procedural Generation Algorithm</h3>
            <p>
              Portal entry triggers dungeon generation via <code>placedungeon()</code>:
            </p>
            <ul>
              <li>Spawn room placed at calculated offset (unique per dungeon instance via <code>SavePortalData</code>)</li>
              <li>Room loop: randomly selects room type (tree room, nether room, bone room), places NBT structure via <code>StructureTemplateManager</code>, adds connecting hallway, advances Z position by 17 blocks</li>
              <li><strong>Probabilistic termination:</strong> 10% base stop chance + 10% per iteration (max 95%), creating expected length of ~10 rooms with high variance</li>
              <li>Boss room placed at terminus with barrier wall at fixed offset</li>
            </ul>
            <p>
              Each dungeon instance gets a unique access number preventing regeneration on re-entry. Coordinates are stored in world-saved data.
            </p>

            <h3>Boss Entity System</h3>
            <p>
              Bosses like <code>MagmaraakhEntity</code> (Lava Dungeon) feature animation state machines with idle/attack states managed by timeout counters. The AI goal stack prioritizes: FloatGoal → custom <code>MaghmaraakhAttack</code> → MeleeAttackGoal → MoveTowardsTargetGoal.
            </p>
            <p>
              The custom attack goal extends <code>MeleeAttackGoal</code> with animation-synchronized damage—a 40-tick wind-up delay before damage is dealt, synced with the attack animation state. Boss stats are substantial: 550 HP, 25 armor, full knockback resistance, 25 armor toughness. Death triggers <code>dungeonRoomEntity.bossDied()</code> for room completion.
            </p>

            <h3>World Generation</h3>
            <p>
              Custom biomes integrate via <strong>Terrablender</strong>, registering overworld regions with weight 4. Each region class overrides <code>addBiomes()</code> to map climate parameters (temperature, humidity, continentalness, erosion) to custom biomes:
            </p>
            <ul>
              <li><strong>Ash Forest:</strong> Hot/arid/inland parameters, features surface lava lakes, custom ash trees (light-emitting logs), magma boulder decorations</li>
              <li><strong>Enchanted Forest:</strong> Ambient particle effects (<code>ENCHANTED_HIT</code> at 0.01f density), custom ambient sound loop, mega jungle-style enchanted trees with 2×2 trunks</li>
            </ul>
            <p>
              Tiered ores (T2–T7) use decreasing rarity: T2 at 12 attempts/chunk across full height range, T7 at 1 attempt/chunk with triangle distribution below Y=-16. Tree placement uses <code>countExtra(9, 0.5f, 7)</code>—base 9 trees plus 50% chance of 7 additional per chunk.
            </p>

            <h3>Dimension System</h3>
            <p>
              Custom dimensions use Forge's <code>ResourceKey</code> registration for <code>LevelStem</code>, <code>Level</code>, and <code>DimensionType</code>. The dungeon dimension specifies fixed noon time, no skylight, zero ambient light, disabled beds/respawn anchors, and a <code>FixedBiomeSource</code> pointing to the dungeon biome. Portal blocks handle bidirectional transport with return coordinates stored in player persistent data.
            </p>

            <h3>Technical Patterns</h3>
            <ul>
              <li><strong>Deferred Registration:</strong> All blocks, items, entities, and block entities use Forge's <code>DeferredRegister</code> pattern for lazy initialization</li>
              <li><strong>Mixin-heavy rendering:</strong> Direct interception of vanilla render calls for maximum glint control, bypassing Forge events</li>
              <li><strong>Distributed room state:</strong> Each trigger block has its own BlockEntity, enabling per-block detection while sharing a single <code>DungeonRoomEntity</code> via flood-fill propagation</li>
              <li><strong>NBT persistence:</strong> Room state (started, defeated, mob counts) survives world saves via <code>saveAdditional()</code>/<code>load()</code></li>
              <li><strong>Structure template composition:</strong> Dungeons built from multiple NBT structures placed sequentially along Z-axis</li>
            </ul>
          </div>
        </main>

        <aside class="project-sidebar">
          
          <div class="meta-block">
            <span class="meta-label">Role</span>
            <span class="meta-value">{project.role}</span>
          </div>

          <div class="meta-block">
            <span class="meta-label">Timeline</span>
            <span class="meta-value">{project.date}</span>
          </div>

          <div class="meta-block">
            <span class="meta-label">Technologies</span>
            <div class="tech-stack-wrap">
              {project.stack.map(tech => (
                <span class="tech-tag">{tech}</span>
              ))}
            </div>
          </div>

          <div class="meta-block">
            <span class="meta-label">Core Systems</span>
            <div class="tech-stack-wrap">
              <span class="tech-tag">7-Tier Rarity</span>
              <span class="tech-tag">Procedural Dungeons</span>
              <span class="tech-tag">Custom Glint Rendering</span>
              <span class="tech-tag">Boss Fights</span>
              <span class="tech-tag">Custom Biomes</span>
            </div>
          </div>

          <div class="meta-block">
            <span class="meta-label">Mixins</span>
            <span class="meta-value">ItemStack, ItemRenderer, HumanoidArmorLayer, RenderBuffers</span>
          </div>

          <div class="meta-block">
            <span class="meta-label">Custom RenderTypes</span>
            <span class="meta-value">~42 (7 tiers × 6 variants)</span>
          </div>

          <div class="meta-block">
            <span class="meta-label">Rarity Multipliers</span>
            <span class="meta-value">1.0× → 1.2× → 1.5× → 2.0× → 3.0× → 3.8× → 5.0×</span>
          </div>

          <div class="action-buttons">
            <a href={project.repoUrl} target="_blank" class="action-btn outline">
              <span class="icon" set:html={githubIcon} />
              View Code
            </a>
          </div>

        </aside>

      </div>

    </div>
  </div>
</Layout>